# MP Ukagaka Version History

> üìã Update records for all versions

---

## [2.1.6] - 2025-12-13

### ‚ú® New Features

- **WordPress Info Integration**: LLM spontaneous dialogue can now retrieve and comment on site info.
  - Integrates WordPress version, theme info (name, version, author), PHP version, site name.
  - Statistics: Post count, comment count, category count, tag count, operation days.
  - Uses transient cache mechanism (5 minutes) to improve performance.
  - Added `wordpress_info` and `statistics` prompt categories.

- **RPG Style Statistics**: Statistics use gamified terms.
  - Demon Encounters (Post Count)
  - Max Damage (Comment Count)
  - Skills Learned (Category Count)
  - Items Used (Tag Count)
  - Adventure Days (Operation Days)

- **Anti-Repetition Mechanism**: Avoids "nonsense loop" issues.
  - Tracks the last response generated by LLM.
  - Adds instructions to avoid repetition in prompts.
  - Automatically generates different casual content or remains silent.

- **Idle Detection**: Automatically pauses auto-dialogue to save resources.
  - Detects user activity (mouse, keyboard, scroll, click).
  - 60-second idle threshold (adjustable).
  - Automatically resumes when user returns.
  - Effectively saves GPU and network resources.

### üîß Improvements

- **LLM System Prompt Enhancement**: Adds WordPress site info as background knowledge.
- **Prompt Diversity**: Added prompts related to WordPress and statistics.
- **Performance Optimization**: Reduced unnecessary LLM requests.
- **Resource Management**: Better GPU and network resource usage control.

### üìù Technical Details

- Added `mpu_get_wordpress_info()` function (in `includes/utility-functions.php`).
- Modified `mpu_generate_llm_dialogue()` function to integrate WordPress info.
- Added idle detection logic to frontend JavaScript (`ukagaka-core.js`).
- AJAX handler supports `last_response` parameter.

---

## [2.1.0] - 2025-11-26

### ‚ú® New Features

- **Configurable Typing Speed**: Added typing effect speed setting (10-200 ms/char).
- **API Key Encrypted Storage**: All API Keys encrypted using AES-256-CBC.
- **Secure File Operations**: All file read/write uses WordPress Filesystem API.
- **Directory Traversal Protection**: Validates all file paths to prevent unauthorized access.

### üîß Improvements

- **Status Indicator**: Configured API Keys show a green checkmark indicator.
- **Error Messages**: Improved error messages for file operations.
- **Backward Compatibility**: Supports automatic encryption of existing plaintext API Keys.

### üîí Security

- All API Keys encrypted using AES-256-CBC.
- File operations use WordPress Filesystem API.
- Added path validation to prevent directory traversal attacks.

---

## [2.0.0] - 2025-11-22

### üèóÔ∏è Architecture Improvements

- **Modular Refactoring**: Split single file into 7 independent modules.
- **Main Program Slimmed**: `mp-ukagaka.php` reduced to about 85 lines.
- **Dependency Loading**: Modules loaded in order of dependency.

### ‚ú® New Features

- **AI Page Awareness**: Automatically generates AI comments based on article content.
- **Multi-AI Provider Support**:
  - Google Gemini (gemini-2.5-flash, gemini-2.5-pro)
  - OpenAI GPT (GPT-4o, GPT-4o-mini, GPT-3.5-turbo)
  - Anthropic Claude (Claude Sonnet 4.5)
- **First Visitor Greeting**: Displays personalized welcome message for new visitors.
- **Slimstat Integration**: Retrieves visitor source, region, etc.
- **AI Text Color**: Customizable AI response text color.
- **AI Display Duration**: Control AI message display time.

### üîß Improvements

- **JSON Dialogue File Support**: Added JSON format support in addition to TXT.
- **Error Handling**: More detailed error logs.
- **Performance Optimization**: Settings reading uses cache mechanism.

### üìÅ Module Structure

```
includes/
‚îú‚îÄ‚îÄ core-functions.php      # Core functions
‚îú‚îÄ‚îÄ utility-functions.php   # Utility functions
‚îú‚îÄ‚îÄ ai-functions.php        # AI functions
‚îú‚îÄ‚îÄ ukagaka-functions.php   # Ukagaka management
‚îú‚îÄ‚îÄ ajax-handlers.php       # AJAX handlers
‚îú‚îÄ‚îÄ frontend-functions.php  # Frontend functions
‚îî‚îÄ‚îÄ admin-functions.php     # Admin functions
```

---

## [1.9.x] - Historical Versions

### 1.9.5

- Fixed compatibility issues with some themes.
- Improved dialogue display effect.

### 1.9.4

- Added auto-dialogue feature.
- Added dialogue interval setting.

### 1.9.3

- Added external dialogue file support (TXT format).
- Added multi-Ukagaka switching feature.

### 1.9.2

- Added page exclusion feature.
- Improved mobile display.

### 1.9.1

- Added fixed message feature.
- Added common session feature.

### 1.9.0

- Added click behavior setting.
- Added session order setting.

---

## [1.8.x] - Historical Versions

### 1.8.5

- Added jQuery compatibility fixes.
- Improved WordPress 5.x compatibility.

### 1.8.0

- Added multi-language support.
- Added Traditional Chinese and Japanese translations.

---

## [1.7.x] - Historical Versions

### 1.7.0

- Added Ukagaka management interface.
- Added create new Ukagaka feature.

---

## [1.6.x] - Historical Versions

### 1.6.0

- Added extensions page.
- Added custom JavaScript feature.

---

## [1.5.x] - Historical Versions

### 1.5.0

- Initial public release.
- Basic Ukagaka display feature.
- Basic dialogue feature.

---

## Upgrade Guide

### Upgrading from 1.x to 2.x

1. **Backup Settings**
   - Recommended to backup `mpu_opt` option in `wp_options` first.

2. **Upgrade Plugin**
   - Upload new version to overwrite old version.
   - Or update via WordPress Admin.

3. **Check Settings**
   - Settings are automatically preserved after upgrade.
   - Recommended to check all settings pages to confirm.

4. **Clear Cache**
   - Clear browser cache.
   - Clear WordPress cache plugin cache.

### Upgrading from 2.0.x to 2.1.x

1. **API Key Auto-Encryption**
   - Existing plaintext API Keys will be automatically encrypted on first save.
   - No manual action required.

2. **Check File Permissions**
   - Ensure `dialogs/` folder is writable.
   - WordPress Filesystem API requires appropriate permissions.

---

## Known Issues

### 2.1.0

- Some older PHP versions (< 7.4) may not support encryption features.
- Recommended to upgrade to PHP 7.4 or higher.

### 2.0.0

- AI features require stable internet connection.
- Some firewalls might block AI API requests.

---

## Reporting Issues

If you find issues, please provide:

1. WordPress Version
2. PHP Version
3. Plugin Version
4. Error Message (if any)
5. Browser Console Errors (Press F12 to view)

---

## Contributors

- **Original Author**: Ariagle *(Original site discontinued)*
- **Maintainer**: Horlicks ([MoeLog](https://www.moelog.com/))

---

**Thanks for all user support and feedback!** ‚ù§Ô∏è
